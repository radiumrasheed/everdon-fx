<div class="row" *ngIf="role$ | async as role">
  <div class="col-sm-12">
    <div class="card">
      <div class="card-header">
        <h4 class="card-title">
          <span class="lstick"></span>
          Request Transaction
        </h4>
      </div>
      <div class="card-body">

        <ngb-alert *ngIf="role !== 'client' && role !== 'fx-ops'" [type]="'warning'"><b>NOTE: </b>You're not eligible to make this request! Please refer to FX-Ops Member</ngb-alert>

        <form class="form" #requestForm="ngForm" (ngSubmit)="requestTransaction()">

          <ng-container *ngIf="role === 'admin'">
            <div class="form-group row">
              <label for="client_id" class="col-md-2 col-form-label">Client</label>
              <div class="col-md-10">
                <div class="input-group">
                  <input hidden name="client_id" [ngModel]="transaction.client_id">
                  <input id="client_id" type="text" class="form-control" placeholder="Search Client..."
                         [class.is-invalid]="searchFailed" [(ngModel)]="model" [inputFormatter]="formatter"
                         [resultFormatter]="formatter"
                         [ngbTypeahead]="search" [placement]="'bottom'" name="model" (selectItem)="updateModel($event)">
                  <span class="input-group-addon" *ngIf="!searching">Search!</span>
                  <span class="input-group-addon" *ngIf="searching">Searching</span>
                  <span class="input-group-addon label label-danger" *ngIf="searchFailed">Search Failed</span>
                </div>
              </div>
            </div>

            <div class="form-group row">
              <label for="transaction-type" class="col-md-2 col-form-label">Transaction Type</label>
              <div class="col-md-10">
                <select class="custom-select col-12" [(ngModel)]="transaction.transaction_type_id" id="transaction-type"
                        name="transaction_type_id">
                  <option *ngFor="let transactionType of transactionTypes" [value]="transactionType.id">{{
                    transactionType.desc }}
                  </option>
                </select>
              </div>
            </div>

            <div class="form-group row">
              <label for="transaction-mode" class="col-md-2 col-form-label">Transaction Mode</label>
              <div class="col-md-10">
                <select class="custom-select col-12" [(ngModel)]="transaction.transaction_mode_id" id="transaction-mode"
                        name="transaction_mode_id">
                  <option *ngFor="let transactionMode of transactionModes" [value]="transactionMode.id">{{
                    transactionMode.desc }}
                  </option>
                </select>
              </div>
            </div>
          </ng-container>


          <div class="form-group row">
            <label for="buying_product_id" class="col-md-2 col-form-label">{{ (role$ | async) === 'client' ? 'I want' :
              'Buying Product' }}<span class="text-danger">*</span></label>
            <div class="col-md-10">
              <select id="buying_product_id" class="custom-select col-12" required
                      [(ngModel)]="transaction.buying_product_id" name="buying_product_id">
                <option *ngFor="let availableProduct of availableProducts" [value]="availableProduct.id">{{
                  availableProduct.description }}
                </option>
              </select>
            </div>
          </div>


          <div class="form-group row">
            <label for="selling_product_id" class="col-md-2 col-form-label">{{ (role$ | async) === 'client' ? 'I have' :
              'Selling Product' }}<span class="text-danger">*</span></label>
            <div class="col-md-10">
              <select id="selling_product_id" class="custom-select col-12" required
                      [(ngModel)]="transaction.selling_product_id" name="selling_product_id">
                <option *ngFor="let availableProduct of availableProducts" [value]="availableProduct.id">{{
                  availableProduct.description }}
                </option>
              </select>
            </div>
          </div>


          <div class="form-group row">
            <label for="product-amount" class="col-md-2 col-form-label">Product Amount<span class="text-danger" *ngIf="newAccount">*</span></label>
            <div class="col-md-10">
              <div class="input-group">
                <!--<span class="input-group-addon" *ngIf="transaction.buying_product_id === '1'">{{ transaction.buying_product_id | currency }}</span>-->
                <!--todo form a PIPE for the above...-->
                <input type="text" class="form-control" required [(ngModel)]="transaction.amount" name="amount"
                       id="product-amount" aria-label="Amount (to the nearest)">

              </div>
            </div>
          </div>


          <div class="form-check offset-2">
            <label class="custom-control custom-checkbox">
              <input type="checkbox" [(ngModel)]="newAccount" name="new_account" (change)="resetAccounts()"
                     class="custom-control-input"> <span class="custom-control-indicator"></span>
              <span class="custom-control-description">Create a new account</span>
            </label>
          </div>


          <div class="form-group row" *ngIf="!newAccount">
            <label for="account_id" class="col-md-2 col-form-label">Account <span class="text-danger" *ngIf="!newAccount">*</span></label>
            <div class="col-md-10">
              <select class="custom-select col-12" [required]="!newAccount" [(ngModel)]="transaction.account_id"
                      id="account_id" name="account_id">
                <option disabled selected="selected" value>- select an account -</option>
                <option *ngFor="let account of accounts" [value]="account.id">{{ account?.bank.toLocaleUpperCase() + ' : ' + account?.number + ' - ' + account?.name }}
                </option>
              </select>
            </div>
          </div>


          <ng-container *ngIf="newAccount">
            <div class="form-group row">
              <div class="form-group col-3">
                <label>Bank <span class="text-danger" *ngIf="newAccount">*</span></label>
                <select class="form-control" [required]="newAccount" [(ngModel)]="transaction.bank_name"
                        name="bank_name" id="bank_name">
                  <option *ngFor="let bank of bankList" value="{{bank.value}}">{{bank.name}}</option>
                </select>
              </div>


              <div class="form-group col-3">
                <label>Account Name <span class="text-danger" *ngIf="newAccount">*</span></label>
                <input type="text" class="form-control" [required]="newAccount" [(ngModel)]="transaction.account_name"
                       name="account_name" placeholder="Account Name">
              </div>


              <div class="form-group col-3">
                <label>Account Number <span class="text-danger" *ngIf="newAccount">*</span></label>
                <input type="text" class="form-control" [required]="newAccount" minlength="10" maxlength="10"
                       [(ngModel)]="transaction.account_number" name="account_number"
                       placeholder="Account Number">
              </div>


              <div class="form-group col-3">
                <label>BVN <span class="text-danger" *ngIf="newAccount">*</span></label>
                <input type="text" class="form-control" [required]="newAccount" minlength="10" maxlength="10"
                       [(ngModel)]="transaction.bvn" name="bvn" placeholder="Enter BVN...">
              </div>
            </div>
          </ng-container>


          <div class="form-group row">
            <div class="col-md-2"></div>
            <div class="col-md-10">
              <button type="submit" [disabled]="!requestForm.form.valid || submitting"
                      class="btn btn-success waves-effect waves-light m-r-10">{{submitting ? 'Sending Request' :
                'Request'}}
              </button>
            </div>
          </div>

        </form>
      </div>
    </div>
  </div>
</div>
